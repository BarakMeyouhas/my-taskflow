(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22,85,893],{3274:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,AuthProvider:()=>l});var a=r(5155),o=r(2115),n=r(5695);let s=(0,o.createContext)(void 0),i=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[r,i]=(0,o.useState)(null),[l,u]=(0,o.useState)(!0),c=(0,n.useRouter)();(0,o.useEffect)(()=>{h()},[]);let h=async()=>{try{let e=localStorage.getItem("token");if(!e)return void u(!1);let t=await fetch("/api/auth/verify",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e.user)}else localStorage.removeItem("token"),i(null)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("token"),i(null)}finally{u(!1)}},d=async(e,t)=>{try{u(!0);let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(r.ok){let e=await r.json();return localStorage.setItem("token",e.token),i(e.user),!0}{let e=await r.json();throw Error(e.message||"Login failed")}}catch(e){throw console.error("Login error:",e),e}finally{u(!1)}},m=async(e,t,r)=>{try{let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:r})});if(a.ok)return!0;{let e=await a.json();throw Error(e.message||"Registration failed")}}catch(e){throw console.error("Registration error:",e),e}};return(0,a.jsx)(s.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:l,login:d,register:m,logout:()=>{localStorage.removeItem("token"),i(null),c.push("/login")},checkAuth:h},children:t})}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5802:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var a=r(5155),o=r(2115),n=r(3274),s=r(5695);let i=e=>{let{children:t}=e,{isAuthenticated:r,isLoading:i}=(0,n.A)(),l=(0,s.useRouter)();return((0,o.useEffect)(()=>{i||r||l.push("/login")},[r,i,l]),i)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):r?(0,a.jsx)(a.Fragment,{children:t}):null}},8364:(e,t,r)=>{Promise.resolve().then(r.bind(r,5802))}},e=>{e.O(0,[441,964,358],()=>e(e.s=8364)),_N_E=e.O()}]);